You are a Senior Application Security Analyst building an enterprise-grade EPSS enrichment automation.

Objective:
Enhance sca.xlsx by fetching EPSS scores for each CVE and calculating a new risk severity using a matrix that maps:

    EPSS Severity  +  Risk to ECW  →  New Severity

Input Files:

1) sca.xlsx
   - Column: "CVE CURRENT VERSION"
   - Column: "Risk to ECW"

2) severity-mapping.xlsx
   - Contains matrix mapping:
        EPSS_SEVERITY
        RISK_TO_ECW
        NEW_SEVERITY

Primary Task:

1. Read all CVE IDs from column:
       "CVE CURRENT VERSION"

2. Validate CVE format strictly using regex:
       CVE-\d{4}-\d{4,7}
   Skip invalid entries safely.

3. Deduplicate CVEs before making API calls.

4. For each valid CVE, fetch EPSS score using REST invoke method only:

       GET https://api.first.org/data/v1/epss?cve=<CVE_ID>

5. Extract:
       epss score (float)
       percentile (optional)

6. Add/Ensure the following columns exist in sca.xlsx:
       EPSS Score
       EPSS Severity
       New Severity

7. Determine EPSS Severity:
       - Use severity-mapping.xlsx EPSS thresholds
       OR
       - If thresholds not separate, derive EPSS_SEVERITY directly from mapping table logic.

8. Determine New Severity using matrix logic:
       - Take EPSS Severity
       - Take corresponding row value from "Risk to ECW"
       - Lookup in severity-mapping.xlsx where:
              EPSS_SEVERITY == derived EPSS severity
              AND
              RISK_TO_ECW == value from sca.xlsx
       - Assign matching NEW_SEVERITY into column:
              "New Severity"

9. Error Handling:
       - If EPSS API returns empty → EPSS Score = "Not Found"
       - If API failure → EPSS Score = "Error"
       - If no matrix match found → New Severity = "Mapping Missing"
       - Implement 3 retries with exponential backoff
       - Handle timeout and rate limiting

10. Performance Controls:
       - Cache CVE → EPSS results
       - Maximum 5 parallel API calls
       - Timeout must be enforced

11. Output:
       - Save enriched file as:
             sca_enriched.xlsx
       - Generate log file:
             epss_enrichment.log
         Log:
             CVE
             EPSS score
             Derived EPSS severity
             Risk to ECW
             Final New Severity
             Errors if any

Security & Compliance Constraints:

       - No hardcoded credentials
       - Strict REST invoke method (requests/curl style)
       - No unsafe execution
       - Fully audit-defensible
       - Defensive input validation

Deliverable:
       Generate complete automation implementation.
       Must be production-ready for enterprise AppSec reporting.